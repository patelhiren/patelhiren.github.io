<!DOCTYPE html>
<html lang="en"><meta charset="utf-8"><meta name="generator" content="Hugo 0.68.3" /><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<meta name="color-scheme" content="light dark">
<meta name="supported-color-schemes" content="light dark"><title>PNG Crush Automator Action&nbsp;&ndash;&nbsp;Hiren Patel</title><link rel="stylesheet" href="/css/core.min.0c56ddbca41b6e2ca9ef7e2ad96bf2e612fafae42d7552606d289d33ab826327cbef9f4f8bdee96c308041f5ebf4b03c.css" integrity="sha384-DFbdvKQbbiyp734q2Wvy5hL6&#43;uQtdVJgbSidM6uCYyfL759Pi97pbDCAQfXr9LA8"><body>
    <div class="base-body"><section id="header" class="site header">
    <div class="header wrap"><span class="header left-side"><a class="site home" href="/"><span class="site name">Hiren Patel</span></a></span>
        <span class="header right-side"><div class="nav wrap"><nav class="nav"><a class="nav item" href="/categories/">Categories</a><a class="nav item" href="/tags/">Tags</a></nav></div></span></div><div class="site slogan"><span class="title">Documenting things as I learn.</span></div></section><div id="content"><div class="article-container"><section class="article header">
    <h1 class="article title">PNG Crush Automator Action</h1><p class="article date">Apr 12, 2020</p></section><article class="article markdown-body"><p>When using png files on the web it is often preferred to use tools like pngcrush on them to optimize their size. This is usually a manual process where a command line tool or website is used to process each image file. I decided to automate this process for me via macOS <a href="https://support.apple.com/guide/automator/welcome/mac"target="_blank">Automator</a>.</p>
<p>To crush png images I use the opensource tool <a href="https://pmt.sourceforge.io/pngcrush/"target="_blank">PNG Crush</a>.</p>
<p>If you have <a href="https://developer.apple.com/xcode/"target="_blank">Xcode</a> installed, the pngcrush tool is included as a part of the iOS SDK and there is no additional download required.</p>
<p>If you do not have Xcode you may install <em>PNG Crush</em> via <a href="https://brew.sh"target="_blank">Homebrew</a> using the following command.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-zsh" data-lang="zsh">brew install pngcrush
</code></pre></td></tr></table>
</div>
</div><p>If using Xcode method, the <code>pngcrush</code> binary will be at <code>/Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/usr/bin/pngcrush</code>.</p>
<p>If using Homebrew, the <code>pngcrush</code> binary will be at <code>/usr/local/bin/pngcrush</code></p>
<p>For the rest of the article I will assume the Homebrew method is used. You just need to adjust the paths for the binary if the Xcode method is used.</p>
<p>To crush a PNG image via Terminal you can run the below command.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-zsh" data-lang="zsh"><span class="c1"># pngcrush will process the input.png and create a compressed crushed.png</span>
pngcrush input.png crushed.png
</code></pre></td></tr></table>
</div>
</div><h2 id="automating-the-process-using-automator-on-macos">Automating the process using Automator on macOS.</h2>
<ul>
<li>Launch <code>Automator</code> via Spotlight Search.</li>
<li>Select <em>File</em>, <em>New</em> from the menu. Select <code>Quick Action</code> and click the <em>Choose</em> button.</li>
</ul>
<p><a target="_blank" rel="noopener noreferrer" 
  href="images/01-Light.png"><img  src="images/01-Light.png"
        alt="Automator - New"/></a></p>
<ul>
<li>In the new windows that loads, select the options as below.
<ul>
<li>Workflow receives current - <em><strong>image files</strong></em></li>
<li>in - <em><strong>Finder.app</strong></em></li>
</ul>
</li>
</ul>
<p><a target="_blank" rel="noopener noreferrer" 
  href="images/02-Light.png"><img  src="images/02-Light.png"
        alt="Automator - New Action"/></a></p>
<ul>
<li>In the search box, type <em><strong>Shell</strong></em> and select the <em><strong>Run Shell Script</strong></em> option to add to the automation on the right by double clicking on it.</li>
</ul>
<p><a target="_blank" rel="noopener noreferrer" 
  href="images/03-Light.png"><img  src="images/03-Light.png"
        alt="Automator - Run Shell Script"/></a></p>
<ul>
<li>Change the <em><strong>Pass Input</strong></em> option to <em><strong>as arguments</strong></em>.</li>
<li>Enter the below script commands in the Shell Script box.</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-zsh" data-lang="zsh"><span class="c1">#for each file</span>
<span class="k">for</span> f in <span class="s2">&#34;</span><span class="nv">$@</span><span class="s2">&#34;</span>
<span class="k">do</span>
    <span class="c1"># verify that the extension of the file is actually png (case insensitive compare)</span>
	<span class="nv">filename</span><span class="o">=</span><span class="k">$(</span>basename <span class="s2">&#34;</span><span class="nv">$f</span><span class="s2">&#34;</span><span class="k">)</span>
	<span class="nv">ext</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">filename</span><span class="p">##*.</span><span class="si">}</span><span class="s2">&#34;</span>
	<span class="k">if</span> <span class="nb">echo</span> <span class="s2">&#34;</span><span class="nv">$ext</span><span class="s2">&#34;</span> <span class="p">|</span> grep -i png<span class="p">;</span> <span class="k">then</span>
        <span class="c1">#if the file is a png, run pngcrush on it. Save the output in the same place with a temporary extension of .crushed_</span>
		/usr/local/bin/pngcrush <span class="s2">&#34;</span><span class="nv">$f</span><span class="s2">&#34;</span> <span class="s2">&#34;</span><span class="nv">$f</span><span class="s2">.crushed_&#34;</span>
        <span class="c1"># overwrite the original file with the crushed file.</span>
		mv <span class="s2">&#34;</span><span class="nv">$f</span><span class="s2">.crushed_&#34;</span> <span class="s2">&#34;</span><span class="nv">$f</span><span class="s2">&#34;</span>
	<span class="k">fi</span>
<span class="k">done</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>Save the automation as <em><strong>PNG Crush</strong></em>.</li>
</ul>
<p><a target="_blank" rel="noopener noreferrer" 
  href="images/04-Light.png"><img  src="images/04-Light.png"
        alt="Automator - Final Code"/></a></p>
<p>You may now browse to any png file(s) in Finder and right click, select <em><strong>Services</strong></em> -&gt; <em><strong>PNG Crush</strong></em>.</p>
<p><a target="_blank" rel="noopener noreferrer" 
  href="images/05-Light.png"><img  src="images/05-Light.png"
        alt="Finder - Services Menu"/></a></p>
<p>While the automation is running you will see a spinning cog in you Menu bar in the top right. When the cog disappears the automation is done and your images have been processed by <em><strong>pngcrush</strong></em>.</p>
<p><a target="_blank" rel="noopener noreferrer" 
  href="images/06-Light.png"><img  src="images/06-Light.png"
        alt="Finder - Automator Running"/></a></p></article><section class="article labels"><a class="category" href=/categories/web/>Web</a><a class="tag" href=/tags/automation/>Automation</a><a class="tag" href=/tags/terminal/>Terminal</a></section></div><section class="article navigation"><p><a class="link" href="/blog/catalina-and-skype-for-business-screensharing/"><span class="li">&rarr;</span>Catalina and Skype for Business Screensharing</a></p></section></div><section id="footer" class="footer"><div class="footer-wrap">
    <p class="copyright">Â©2020 Hiren Patel.</p>
    <p class="powerby"><span>Powered by </span><a href="https://gohugo.io" 
        target="_blank">Hugo</a><span> and the </span><a href="https://themes.gohugo.io/hugo-notepadium/" 
        target="_blank">Notepadium</a></p>
</div></section></div>
</body>

</html>