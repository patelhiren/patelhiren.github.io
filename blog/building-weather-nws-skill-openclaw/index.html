<!DOCTYPE html>
<html lang="en"><meta charset="utf-8"><meta name="generator" content="Hugo 0.157.0"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<meta name="color-scheme" content="light dark">
<meta name="supported-color-schemes" content="light dark"><meta name="description" content="I wanted snow accumulation forecasts from OpenClaw, but the wttr.in skill only returned &ldquo;Heavy snow&rdquo; text. I needed: how much snow, when it starts. I discovered the National Weather Service API‚Äîfree, no API key, US-only‚Äîand built a unified skill with AirNow AQI and global fallback."><title>Building the Weather-NWS Skill for OpenClaw&nbsp;&ndash;&nbsp;Hiren Patel</title><link rel="stylesheet" href="/css/core.min.417c6d8a62d24ff59c1f7302f2015d21148c22ef43637f8a725ed052759a8559e3f83441120a50b4d9ce850c20543f5c.css" integrity="sha384-QXxtimLST/WcH3MC8gFdIRSMIu9DY3&#43;Kcl7QUnWahVnj&#43;DRBEgpQtNnOhQwgVD9c"><meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="Building the Weather-NWS Skill for OpenClaw" /><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" as="style" onload="this.rel='stylesheet'" />

<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
<link rel="manifest" href="/site.webmanifest" />
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#191919" />
<meta name="msapplication-TileColor" content="#00aba9" />
<body><section id="header" class="site header">
    <div class="header wrap"><span class="header left-side"><a class="site home" href="/"><img alt="" loading="lazy" class="site logo" src="/patelhiren-logo.png"/><span class="site name">Hiren Patel</span></a></span>
        <span class="header right-side"><div class="nav wrap"><nav class="nav"><a class="nav item" href="/categories/">Categories</a><a class="nav item" href="/tags/">Tags</a><a class="nav item" href="/about/">About</a></nav></div></span></div><div class="site slogan wrap">
            <span class="title left-side">Documenting things as I learn.</span>
            <span class="right-side"><div class="social-buttons">
    <a href="/index.xml" aria-label="Subscribe in your RSS reader">
        <span>
            <i class="fa-solid fa-rss"></i>
        </span>
    </a>
    <a rel="me" href="https://mastodon.social/@patelhiren" target="_blank" aria-label="Follow @patelhiren on Mastodon">
        <span>
            <i class="fa-brands fa-mastodon"></i>
        </span>
    </a>
    <a href="https://twitter.com/patelhiren" target="_blank" aria-label="Follow @patelhiren on Twitter">
        <span>
            <i class="fa-brands fa-twitter"></i>
        </span>
    </a>
</div></span>
        </div></section><section id="content"><div class="article-container"><section class="article header">
    <h1 class="article title">Building the Weather-NWS Skill for OpenClaw</h1><p class="article date">Feb 27, 2026</p></section><article class="article markdown-body"><p>I wanted snow accumulation forecasts from OpenClaw, but the wttr.in skill only returned &ldquo;Heavy snow&rdquo; text. I needed: how much snow, when it starts. I discovered the National Weather Service API‚Äîfree, no API key, US-only‚Äîand built a unified skill with AirNow AQI and global fallback.</p>
<h2 id="discovery-nws-api">Discovery: NWS API</h2>
<p>The <a href="https://api.weather.gov/"target="_blank" rel="noopener noreferrer">National Weather Service API</a> returns structured data:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="s2">&#34;snowfallAmount&#34;</span><span class="err">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;values&#34;</span><span class="p">:</span> <span class="p">[{</span><span class="nt">&#34;validTime&#34;</span><span class="p">:</span> <span class="s2">&#34;2026-02-27T18:00:00/PT24H&#34;</span><span class="p">,</span> <span class="nt">&#34;value&#34;</span><span class="p">:</span> <span class="mi">13</span><span class="p">}],</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;unitCode&#34;</span><span class="p">:</span> <span class="s2">&#34;wmoUnit:mm&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>No API key required. Requests against <code>api.weather.gov</code> just work. But it&rsquo;s US-only‚Äîinternational locations need <a href="https://wttr.in/"target="_blank" rel="noopener noreferrer">wttr.in</a> fallback.</p>
<p>Gridpoint API (<code>/gridpoints/{wfo}/{x},{y}</code>) has structured snow/ice/rain values. Zone forecast API is less detailed. Grid lookup requires geocoding first via <code>/points/{lat},{lon}</code>.</p>
<p>Later I discovered <a href="https://www.airnow.gov/"target="_blank" rel="noopener noreferrer">AirNow</a> AQI‚Äîalso no API key. Useful when deciding if post-storm shoveling is safe.</p>
<h2 id="api-hierarchy">API Hierarchy</h2>
<p>The skill auto-detects source based on location:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">if</span> <span class="n">is_us_location</span><span class="p">(</span><span class="n">location</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">get_nws_data</span><span class="p">(</span><span class="n">location</span><span class="p">)</span>  <span class="c1"># Structured accumulations</span>
</span></span><span class="line"><span class="cl"><span class="k">return</span> <span class="n">get_wttr_data</span><span class="p">(</span><span class="n">location</span><span class="p">)</span>     <span class="c1"># Text fallback</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="temporal-query-detection">Temporal Query Detection</h2>
<p>wttr.in returns day summaries. I wanted hourly breakdowns for &ldquo;What time does the rain stop?&rdquo;</p>
<p>The skill detects time qualifiers:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">strip_temporal_qualifiers</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">patterns</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="sa">r</span><span class="s1">&#39;\s+at\s+\d{1,2}\s*(?::\d</span><span class="si">{2}</span><span class="s1">)?\s*[APap][Mm]?&#39;</span><span class="p">,</span>  <span class="c1"># &#34;at 8 PM&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="sa">r</span><span class="s1">&#39;\s+around\s+\d{1,2}&#39;</span><span class="p">,</span>                            <span class="c1"># &#34;around 3&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="sa">r</span><span class="s1">&#39;\s+this\s+(?:morning|afternoon|evening)&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="sa">r</span><span class="s1">&#39;\s+tonight&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>When detected, it queries <code>/gridpoints/{wfo}/{x},{y}/forecast/hourly</code> instead‚Äî156 hourly periods (~7 days).</p>
<h2 id="phase-implementation">Phase Implementation</h2>
<h3 id="phase-1-core-with-grid-data">Phase 1: Core with Grid Data</h3>
<p><code>get_weather.py</code> orchestrates the unified call:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">./scripts/get_weather.py <span class="s2">&#34;Seattle&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Script flow:</p>
<ol>
<li>Geocode via NWS <code>/points</code> endpoint for grid ID and forecast URLs</li>
<li>Fetch structured forecast or hourly if temporal detected</li>
<li>If <code>--aqi</code> flag, fetch AirNow current + forecast</li>
<li>For non-US locations, hit wttr.in</li>
</ol>
<h3 id="phase-2-station-observations">Phase 2: Station Observations</h3>
<p>NWS has observed conditions at weather stations. Added <code>--current</code> flag to compare forecast vs reality:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="c1">// /stations/{stationId}/observations/latest
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;properties&#34;</span><span class="err">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;temperature&#34;</span><span class="p">:</span> <span class="p">{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span> <span class="mi">43</span><span class="p">,</span> <span class="nt">&#34;unitCode&#34;</span><span class="p">:</span> <span class="s2">&#34;wmoUnit:degC&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;windSpeed&#34;</span><span class="p">:</span> <span class="p">{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span> <span class="mf">5.14</span><span class="p">,</span> <span class="nt">&#34;unitCode&#34;</span><span class="p">:</span> <span class="s2">&#34;wmoUnit:km_h-1&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="phase-3-edge-cases">Phase 3: Edge Cases</h3>
<ul>
<li><strong>Aviation TAFs</strong>: Terminal forecasts via <code>/stations/{stationId}/tafs</code>. Most civilian stations lack TAF‚Äîuse <code>--taf</code> explicitly</li>
<li><strong>Astronomical</strong>: Sunrise/sunset via <code>skyfield</code> library with <code>--astro</code></li>
<li><strong>Fire weather</strong>: Red flag warnings from NWS alerts API with <code>--fire</code></li>
</ul>
<h2 id="declaring-environment-variables">Declaring Environment Variables</h2>
<p><a href="https://clawhub.ai/"target="_blank" rel="noopener noreferrer">Clawdhub.ai</a> validates skills before listing. Skills using environment variables must declare them in <code>SKILL.md</code> metadata or get flagged as suspicious.</p>
<p>Added the <code>clawdis</code> block to register <code>AIRNOW_API_KEY</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">metadata</span><span class="p">:</span><span class="w"> </span>{<span class="s2">&#34;clawdhub&#34;</span><span class="p">:</span>{<span class="s2">&#34;emoji&#34;</span><span class="p">:</span><span class="s2">&#34;üå¶Ô∏è&#34;</span>}<span class="p">,</span><span class="s2">&#34;clawdis&#34;</span><span class="p">:</span>{<span class="s2">&#34;envVars&#34;</span><span class="p">:[</span>{<span class="s2">&#34;name&#34;</span><span class="p">:</span><span class="s2">&#34;AIRNOW_API_KEY&#34;</span><span class="p">,</span><span class="s2">&#34;required&#34;</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span><span class="s2">&#34;description&#34;</span><span class="p">:</span><span class="s2">&#34;AirNow API Key for AQI lookup&#34;</span>}<span class="p">]</span>}}<span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>This tells the validation system:</p>
<ul>
<li>The skill accepts an optional <code>AIRNOW_API_KEY</code> environment variable</li>
<li>It&rsquo;s not required‚ÄîAirNow works unauthenticated with stricter rate limits</li>
<li>OpenClaw injects the variable if configured in <code>clawdbot.json</code></li>
</ul>
<h2 id="usage">Usage</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Standard forecast</span>
</span></span><span class="line"><span class="cl">./scripts/get_weather.py <span class="s2">&#34;Boston&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Hourly with AQI</span>
</span></span><span class="line"><span class="cl">./scripts/get_weather.py <span class="s2">&#34;Boston at 8 PM&#34;</span> --aqi
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Current observations vs forecast</span>
</span></span><span class="line"><span class="cl">./scripts/get_weather.py <span class="s2">&#34;Boston&#34;</span> --current
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Aviation TAF (if available)</span>
</span></span><span class="line"><span class="cl">./scripts/get_weather.py <span class="s2">&#34;JFK&#34;</span> --taf
</span></span></code></pre></td></tr></table>
</div>
</div><p>Available on <a href="https://clawhub.ai/patelhiren/weather-nws"target="_blank" rel="noopener noreferrer">clawdhub.ai/patelhiren/weather-nws</a>.</p></article><section class="article labels"><a class="category" href=/categories/ai-automation/>AI Automation</a><a class="category" href=/categories/programming/>Programming</a><a class="tag" href=/tags/openclaw/>OpenClaw</a><a class="tag" href=/tags/python/>Python</a><a class="tag" href=/tags/weather/>Weather</a><a class="tag" href=/tags/nws/>NWS</a><a class="tag" href=/tags/apis/>APIs</a></section>
</div>
<div class="article bottom"><section class="article navigation"><p><a class="link" href="/blog/macos-newsyslog-openclaw-logs/"><span class="iconfont icon-article"></span>Using macOS newsyslog to Rotate Service Logs</a></p></section></div></section><section id="footer"><div class="footer-wrap">
    <p class="copyright">¬© Copyright 2026, ¬© Copyright {year}, Hiren Patel</p>
    <p class="disclaimer">Disclaimer: The opinions expressed herein are my own personal opinions and do not represent my employer‚Äôs view in any way.</p>
</div></section>
    
    <script defer src='https://static.cloudflareinsights.com/beacon.min.js' 
        data-cf-beacon='{"token": "0ceb2b0172264816ba290291f3b99e4f"}'></script>
    
</body>

</html>