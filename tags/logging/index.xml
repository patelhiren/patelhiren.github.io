<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/"><channel><title>Logging on Hiren Patel</title><link>https://patelhiren.com/tags/logging/</link><description>Recent content in Logging on Hiren Patel</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><copyright>© Copyright {year}, Hiren Patel</copyright><lastBuildDate>Wed, 25 Feb 2026 00:00:00 +0000</lastBuildDate><atom:link href="https://patelhiren.com/tags/logging/index.xml" rel="self" type="application/rss+xml"/><item><title>Using macOS newsyslog to Rotate Service Logs</title><link>https://patelhiren.com/blog/macos-newsyslog-openclaw-logs/</link><pubDate>Wed, 25 Feb 2026 00:00:00 +0000</pubDate><guid>https://patelhiren.com/blog/macos-newsyslog-openclaw-logs/</guid><description>&lt;p&gt;I noticed my &lt;a href="https://clawd.bot/"target="_blank" rel="noopener noreferrer"&gt;OpenClaw&lt;/a&gt; gateway log files were growing unbounded. The service runs via &lt;a href="https://developer.apple.com/library/archive/documentation/MacOSX/Conceptual/BPSystemStartup/Chapters/CreatingLaunchdJobs.html"target="_blank" rel="noopener noreferrer"&gt;launchd&lt;/a&gt;, and while the app has built-in log rotation, the stdout/stderr capture in the launchd plist was bypassing it entirely.&lt;/p&gt;</description><content:encoded><![CDATA[<p>I noticed my <a href="https://clawd.bot/"target="_blank" rel="noopener noreferrer">OpenClaw</a> gateway log files were growing unbounded. The service runs via <a href="https://developer.apple.com/library/archive/documentation/MacOSX/Conceptual/BPSystemStartup/Chapters/CreatingLaunchdJobs.html"target="_blank" rel="noopener noreferrer">launchd</a>, and while the app has built-in log rotation, the stdout/stderr capture in the launchd plist was bypassing it entirely.</p>
<h2 id="the-problem">The Problem</h2>
<p>When a macOS service uses <code>StandardOutPath</code> and <code>StandardErrorPath</code> in its launchd plist, those files just append forever. My logs had grown to 38MB with no mechanism to clean them up:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ ls -lh ~/.openclaw/logs/
</span></span><span class="line"><span class="cl">-rw-r--r--  <span class="m">1</span> clawd  staff  3.9M Feb <span class="m">25</span> 17:48 gateway.log
</span></span><span class="line"><span class="cl">-rw-r--r--  <span class="m">1</span> clawd  staff  38M  Feb <span class="m">25</span> 17:48 gateway.err.log
</span></span></code></pre></td></tr></table>
</div>
</div><p>OpenClaw&rsquo;s internal logger writes date-based rotating logs to <code>/tmp/openclaw/</code>, but launchd&rsquo;s stdout capture writes directly to the configured files, bypassing that rotation logic.</p>
<p><strong>The Hidden Trap:</strong> When log rotation tools like <code>newsyslog</code> create new log files, they default to <code>root:root</code> ownership. If your launchd service runs as your user (not root), it suddenly can&rsquo;t write to its own log files after rotation. The daemon fails to start with &ldquo;Permission denied&rdquo; errors, and you&rsquo;re left wondering why your service won&rsquo;t start.</p>
<h2 id="the-solution-newsyslog">The Solution: newsyslog</h2>
<p>macOS includes <a href="https://www.freebsd.org/cgi/man.cgi?newsyslog%288%29"target="_blank" rel="noopener noreferrer">newsyslog</a>, a utility for managing log file rotation. It&rsquo;s already running on your system, checking logs periodically via launchd. You just need to tell it about your custom log files.</p>
<h3 id="configuration">Configuration</h3>
<p>Create a config file for your service logs:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo tee /etc/newsyslog.d/openclaw.conf <span class="s">&lt;&lt; &#39;EOF&#39;
</span></span></span><span class="line"><span class="cl"><span class="s"># OpenClaw gateway logs - rotate at 10MB, keep zero archives
</span></span></span><span class="line"><span class="cl"><span class="s">/Users/clawd/.openclaw/logs/gateway.log    clawd:staff    644  0  10000  *  B
</span></span></span><span class="line"><span class="cl"><span class="s">/Users/clawd/.openclaw/logs/gateway.err.log    clawd:staff    644  0  10000  *  B
</span></span></span><span class="line"><span class="cl"><span class="s">EOF</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Important:</strong> Notice the <code>clawd:staff</code> owner:group fields. Without these, newsyslog creates the new log files as <code>root:root</code> after rotation. When your launchd service tries to write to a root-owned file, it gets &ldquo;Permission denied&rdquo; and the daemon fails to start.</p>
<p>Field breakdown:</p>
<ul>
<li><code>clawd:staff</code> — Owner and group for the log files (critical!)</li>
<li><code>644</code> — File permissions (owner read/write, others read-only)</li>
<li><code>0</code> — Number of archived files to keep (zero = just truncate)</li>
<li><code>10000</code> — Size threshold in KB (~10MB)</li>
<li><code>*</code> — Rotate at any time (not just specific hours)</li>
<li><code>B</code> — Treat as binary (no special encoding)</li>
</ul>
<h3 id="what-happens-without-owner-specified">What Happens Without Owner Specified</h3>
<p>If you omit the owner:group fields, you&rsquo;ll see this after newsyslog runs:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ ls -la ~/.openclaw/logs/
</span></span><span class="line"><span class="cl">-rw-r--r--  <span class="m">1</span> root   wheel     <span class="m">0</span> Feb <span class="m">25</span> 18:30 gateway.log
</span></span><span class="line"><span class="cl">-rw-r--r--  <span class="m">1</span> root   wheel     <span class="m">0</span> Feb <span class="m">25</span> 18:30 gateway.err.log
</span></span></code></pre></td></tr></table>
</div>
</div><p>Then your service fails to start with errors like:</p>
<pre tabindex="0"><code>Could not open log file /Users/clawd/.openclaw/logs/gateway.log: Permission denied
Service exited with abnormal code: 1
</code></pre><p>The <code>clawd:staff</code> fields ensure the rotated files remain owned by your user, not root.</p>
<h3 id="reload-and-verify">Reload and Verify</h3>
<p>Tell newsyslog to reload its configuration:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo killall -HUP newsyslog
</span></span></code></pre></td></tr></table>
</div>
</div><p>Check that the config loaded correctly:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo newsyslog -v -f /etc/newsyslog.d/openclaw.conf
</span></span></code></pre></td></tr></table>
</div>
</div><p>Force an immediate rotation to test:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo newsyslog -v -f /etc/newsyslog.d/openclaw.conf -R <span class="s2">&#34;manual&#34;</span> ~/.openclaw/logs/gateway.err.log
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p><strong>Note:</strong> The <code>-R</code> flag with a requestor name is optional. Plain <code>newsyslog -v -f /path/to/config</code> works fine for testing.</p>
</blockquote>
<h2 id="why-not-cron">Why Not Cron?</h2>
<p>I considered a simple cron job:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="m">0</span> <span class="m">3</span> * * * truncate -s <span class="m">0</span> ~/.openclaw/logs/gateway.log
</span></span></code></pre></td></tr></table>
</div>
</div><p>That would work, but newsyslog is the native macOS tool for this. It&rsquo;s already running, already has permission handling figured out, and rotates based on file size rather than just time. If your log suddenly explodes to 500MB, newsyslog catches it on the next check cycle (every 30 minutes). Cron would wait until 3 AM.</p>
<h2 id="result">Result</h2>
<p>After setup, my 38MB error log was truncated to zero bytes:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ ls -lh ~/.openclaw/logs/
</span></span><span class="line"><span class="cl">-rw-r--r--  <span class="m">1</span> clawd  staff  4.9M Feb <span class="m">25</span> 18:02 gateway.log
</span></span><span class="line"><span class="cl">-rw-r--r--  <span class="m">1</span> clawd  staff   0B  Feb <span class="m">25</span> 18:10 gateway.err.log
</span></span></code></pre></td></tr></table>
</div>
</div><p>No manual intervention needed going forward. When either file crosses 10MB, newsyslog truncates it automatically.</p>
<h2 id="references">References</h2>
<ul>
<li><a href="https://www.freebsd.org/cgi/man.cgi?newsyslog%288%29"target="_blank" rel="noopener noreferrer">newsyslog man page</a></li>
<li><a href="https://docs.openclaw.ai/"target="_blank" rel="noopener noreferrer">OpenClaw documentation</a></li>
<li><a href="https://developer.apple.com/library/archive/documentation/MacOSX/Conceptual/BPSystemStartup/Chapters/CreatingLaunchdJobs.html"target="_blank" rel="noopener noreferrer">launchd documentation</a></li>
</ul>]]></content:encoded></item></channel></rss>